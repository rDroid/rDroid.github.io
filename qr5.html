<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Screen QR Code Scanner</title>
    <script src="https://unpkg.com/@zxing/browser@latest"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: black;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .guidelines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }
        .guidelines::before, .guidelines::after {
            content: '';
            position: absolute;
            border: 2px solid #00ff00;
            z-index: 2;
        }
        .guidelines::before {
            width: 60%;
            height: 60%;
            box-sizing: border-box;
        }
        .guidelines::after {
            width: 15px;
            height: 15px;
            background-color: #00ff00;
        }
        #scanning-animation {
            position: absolute;
            top: 0;
            width: 100%;
            height: 3px;
            background-color: #00ff00;
            z-index: 3;
            animation: scanning 2s infinite;
        }
        @keyframes scanning {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(100%);
            }
        }
        #result {
            position: absolute;
            bottom: 20px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            z-index: 4;
        }
    </style>
</head>
<body>
    <video id="preview"></video>
    <div class="guidelines"></div>
    <div id="scanning-animation"></div>
    <div id="result">Align QR code within the box...</div>

    <script>
        const codeReader = new ZXing.BrowserQRCodeReader();
        const videoElement = document.getElementById('preview');
        const resultElement = document.getElementById('result');
        let scanning = true;

        async function startScanner() {
            try {
                const devices = await codeReader.listVideoInputDevices();
                if (devices.length === 0) {
                    resultElement.textContent = 'No camera found!';
                    return;
                }

                // Choose rear camera if available
                const selectedDeviceId = devices.find(device => device.label.toLowerCase().includes('back'))?.deviceId || devices[0].deviceId;

                // Start scanning
                await codeReader.decodeFromVideoDevice(selectedDeviceId, videoElement, (result, error) => {
                    if (result && scanning) {
                        scanning = false;
                        resultElement.textContent = `Result: ${result.text}`;
                        stopScanner();
                    } else if (error) {
                        console.log(error);
                    }
                });

                resultElement.textContent = 'Align QR code within the box...';
            } catch (error) {
                console.error('Error initializing scanner:', error);
                resultElement.textContent = 'Error initializing scanner!';
            }
        }

        function stopScanner() {
            codeReader.reset();
            videoElement.srcObject?.getTracks().forEach(track => track.stop());
            setTimeout(() => {
                alert('Scanning completed!');
                resultElement.textContent = 'Camera closed.';
            }, 1000);
        }

        // Start scanner on page load
        window.addEventListener('load', startScanner);
    </script>
</body>
</html>
